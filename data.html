<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="home.css">
    <title>All Responses</title>
</head>
<body>
    <nav>
        <input type="checkbox" id="check">
        <label for="check" class="checkbtn">
          <i class="fas fa-bars"></i>
        </label> <b>
  
        
        <label class="logo">Origin Training</label>
        <ul>
          <li><a class="active" href="/">Home</a></li>
          <li><a href="about.html">About</a></li>
          <li><a href="testimonials.html">Testimonials</a></li>
          <li><a href="#">Gallery</a></li>
          <li><a href="contact.html">Contact us</a></li>
          <li><a href="admin.html" id="dynamic-link">Admin Login</a></li>
        </ul>
      </b>
      </nav>
    <div class="card">
        <h2>Objectives and Training Activities by OG(Origin Group)</h2>
      <div class="container">
        <h4><b>All Responses</b></h4> 
            
  
            

            <div class="responses">

            </div>
          
            
      </div>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js" integrity="sha512-bZS47S7sPOxkjU/4Bt0zrhEtWx0y0CRkhEp8IckzK+ltifIIE9EMIMTuT/mEzoIMewUINruDBIR/jJnbguonqQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.2.1/js.cookie.min.js" integrity="sha512-Meww2sXqNHxI1+5Dyh/9KAtvI9RZSA4c1K2k5iL02oiPO/RH3Q30L3M1albtqMg50u4gRTYdV4EXOQqXEI336A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script>


//detect is login or not

window.onload = ()=>{
    if(!Cookies.get("IS_LOGIN")){
        window.location.href="admin.html";
    }
}
        // get all response back from the backend
            const responseContainer = document.querySelector('.responses');




        const getResponses  = async ()=>{
            axios.get('http://localhost:5000/contact').then((response)=>{
                console.log(response.data);

                const {data} = response;




                data.forEach((r)=>{
                    responseContainer.innerHTML+=`
                    <div class="response-card">
                        <h3>${r.enq}</h3>
                        <span>Upload by:${r.name}</span>
                        <button class="del_btn" id="${r._id}"">Delete</button>
                    </div>`;
                })



                const del_btns =document.querySelectorAll('.del_btn');

        console.log(del_btns)


        Array.from(del_btns).forEach((button)=>{
            button.addEventListener('click',(e)=>{
                console.log('Working...')
                console.log(e.target.id);
            axios.delete(`http://localhost:5000/contact/delete/${e.target.id}`).then((response)=>{
                if(response.status===200){
                    alert('Record Deleted!');
                    return window.location.href="data.html";
                }
            }).catch((e)=>{
                console.log(e);
            });
            })
        })

            }).catch((e)=>{
                console.log(`Error ${e}`);
            })
        }

        getResponses();


    </script>
</body>
</html>